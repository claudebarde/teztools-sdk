"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});var Q=(o=>(o.FA12="fa1.2",o.FA2="fa2",o.XTZ="XTZ",o))(Q||{});const b=o=>typeof o!="string"||(o=o.trim(),o.length===0)?!1:o.slice(0,2)==="tz"?new RegExp("tz[123][1-9A-HJ-NP-Za-km-z]{33}").test(o):o.slice(0,2)==="KT"?new RegExp("KT1[1-9A-HJ-NP-Za-km-z]{33}").test(o):!1;class ee{constructor(){this.pricesApiUrl="https://api.teztools.io/v1/prices",this.xtzPriceUrl="https://api.teztools.io/v1/xtz-price",this.xtzPrice=void 0,this.defaultFiat="USD",this.xtzExchangeRate=void 0,this.tokenTags=[],this.numberOfTokens=0,this.tokensPrices=[],this.tokensList=[],window?this.fetch=async e=>{const i=await this.fetch(e);return i?await i.json():null}:this.fetch=async e=>{const l=await(await Promise.resolve().then(function(){return require("./index.js")}).then(function(a){return a.index})).default.get(e);return l?l.data:null}}is_number(e){return!isNaN(+e)}is_timestamp(e){return new Date(e).getTime()>0}is_string(e){return typeof e=="string"}is_boolean(e){return typeof e=="boolean"}is_url(e){try{return new URL(e),!0}catch{return!1}}async init(e){const i=e&&e.prices?e.prices:!0,l=e&&e.xtzPrice?e.xtzPrice:!0,a=e&&e.defaultFiat?e.defaultFiat:"USD",c=e&&e.fiatExchangeRate?e.fiatExchangeRate:void 0;if(i)try{const n=await this.fetch(this.pricesApiUrl);if(n){if(typeof n!="object")throw`Expected object from token prices API, got ${typeof n}`;if(typeof n=="object"&&!n.hasOwnProperty("contracts"))throw`Object received from token prices API doesn't have a "contracts" property`;if(typeof n=="object"&&n.hasOwnProperty("contracts")&&!Array.isArray(n.contracts))throw`Expected contracts property from token prices API to be an array, got ${typeof n.contracts} instead`;this.numberOfTokens=n.contracts.length,n.contracts.forEach(s=>{let t={symbol:null,tokenAddress:null,decimals:null,name:null,shouldPreferSymbol:null,factoryIndex:null,address:null,ratio:null,tezPool:null,tokenPool:null,currentPrice:null,lastPrice:null,buyPrice:null,sellPrice:null,precision:null,type:null,bakerValidator:null,currentCandidate:null,currentDelegated:null,lastUpdateTime:null,lastVeto:null,periodFinish:null,reward:null,rewardPaid:null,rewardPerSec:null,totalReward:null,totalSupply:null,qptTokenSupply:null,totalVotes:null,usdValue:null,pairs:[],tags:null,websiteLink:null,telegramLink:null,twitterLink:null,discordLink:null,thumbnailUri:null,timestamp:null,block:null};Object.keys(s).forEach(r=>{switch(r){case"symbol":const h=s[r];this.is_string(h)?(this.tokensList.push(h),t.symbol=h):t.symbol=null;break;case"tokenAddress":const m=s[r];t.tokenAddress=(()=>this.is_string(m)&&b(m)?{address:m,isValid:!0}:null)();break;case"decimals":const y=s[r];t.decimals=this.is_number(y)?y:null;break;case"name":const x=s[r];t.name=this.is_string(x)?x:null;break;case"shouldPreferSymbol":t.shouldPreferSymbol=this.is_boolean(s[r])?s[r]:null;break;case"factoryIndex":const T=s[r];t.factoryIndex=this.is_number(T)?T:null;break;case"address":const k=s[r];t.address=(()=>this.is_string(k)&&b(k)?{address:k,isValid:!0}:null)();break;case"ratio":const V=s[r];t.ratio=this.is_number(V)?V:null;break;case"tezPool":const z=s[r];t.tezPool=this.is_number(z)?z:null;break;case"tokenPool":const L=s[r];t.tokenPool=this.is_number(L)?L:null;break;case"currentPrice":const S=s[r];t.currentPrice=this.is_number(S)?S:null;break;case"lastPrice":const A=s[r];t.lastPrice=this.is_number(A)?A:null;break;case"buyPrice":const U=s[r];t.buyPrice=this.is_number(U)?U:null;break;case"sellPrice":const v=s[r];t.sellPrice=this.is_number(v)?v:null;break;case"precision":const C=s[r];t.precision=this.is_number(C)?C:null;break;case"type":switch(s[r]){case"fa1.2":t.type="fa1.2";break;case"fa2":t.type="fa2";break;case"XTZ":t.type="XTZ";break;default:t.type=null;break}break;case"bakerValidator":const E=s[r];t.bakerValidator=b(E)?E:null;break;case"currentCandidate":const R=s[r];t.currentCandidate=b(R)?R:null;break;case"currentDelegated":const F=s[r];t.currentDelegated=b(F)?F:null;break;case"lastUpdateTime":const D=s[r];t.lastUpdateTime=this.is_timestamp(D)?D:null;break;case"lastVeto":const j=s[r];t.lastVeto=this.is_timestamp(j)?j:null;break;case"periodFinish":const O=s[r];t.periodFinish=this.is_timestamp(O)?O:null;break;case"reward":const I=s[r];t.reward=this.is_number(I)?I:null;break;case"rewardPaid":const B=s[r];t.rewardPaid=this.is_number(B)?B:null;break;case"rewardPerSec":const Z=s[r];t.rewardPerSec=this.is_number(Z)?Z:null;break;case"totalReward":const N=s[r];t.totalReward=this.is_number(N)?N:null;break;case"totalSupply":const q=s[r];t.totalSupply=this.is_number(q)?q:null;break;case"qptTokenSupply":const X=s[r];t.qptTokenSupply=this.is_number(X)?X:null;break;case"totalVotes":const H=s[r];t.totalVotes=this.is_number(H)?H:null;break;case"usdValue":const J=s[r];t.usdValue=this.is_number(J)?J:null;break;case"pairs":const Y=s[r],M=[];Y.forEach(d=>{let K={address:b(d.address)?d.address:null,dex:this.is_string(d.dex)?d.dex:null,symbols:this.is_string(d.symbols)?d.symbols:null,tvl:this.is_number(d.tvl)?d.tvl:null,lptSupply:this.is_number(d.lptSupply)?d.tvl:null,sides:Array.isArray(d.sides)?[...d.sides.map(u=>({symbol:this.is_string(u.symbol)?u.symbol:null,pool:this.is_number(u.pool)?u.pool:null,price:this.is_number(u.price)?u.price:null,usdvalue:this.is_number(u.usdvalue)?u.usdvalue:null,dayClose:this.is_number(u.dayClose)?u.dayClose:null,weekClose:this.is_number(u.weekClose)?u.weekClose:null,monthClose:this.is_number(u.monthClose)?u.monthClose:null,tokenType:this.is_string(u.tokenType)?u.tokenType:null}))]:null};M.push(K)}),t.pairs=M;break;case"tags":const W=s[r];t.tags=this.is_string(W)?W:null;break;case"websiteLink":const p=s[r];t.websiteLink=(()=>this.is_string(p)?{url:p,isValid:this.is_url(p)}:null)();break;case"telegramLink":const P=s[r];t.telegramLink=(()=>this.is_string(P)?{url:P,isValid:this.is_url(P)}:null)();break;case"twitterLink":const g=s[r];t.twitterLink=(()=>this.is_string(g)?{url:g,isValid:this.is_url(g)}:null)();break;case"discordLink":const w=s[r];t.discordLink=(()=>this.is_string(w)?{url:w,isValid:this.is_url(w)}:null)();break;case"thumbnailUri":const _=s[r];t.thumbnailUri=(()=>this.is_string(_)?{url:_,isValid:this.is_url(_)}:null)();break;case"timestamp":const $=s[r];t.timestamp=this.is_timestamp($)?$:null;break;case"block":const G=s[r];t.block=this.is_string(G)?G:null;break}}),this.tokensPrices.push(t)}),this.tokenTags=Array.from(new Set(this.tokensPrices.map(s=>s.tags).filter(s=>s!==null)))}else throw"No response from the tokens prices API"}catch{console.error()}if(l)try{const n=await this.fetch(this.xtzPriceUrl);if(n){let s={fullData:!0,price:null,price24h:null,marketCap:null,market24h:null,volume:null,volume24h:null,updated:null};const t=Object.keys(s),f=Object.keys(n);(!f.map(h=>t.includes(h)).reduce((h,m)=>h&&m)||t.length===f.length)&&(s.fullData=!1),Object.keys(s).forEach(h=>{n.hasOwnProperty(h)&&(h==="updated"&&this.is_timestamp(n[h])?s.updated=n.updated:this.is_number(n[h])&&(s[h]=+n[h]))}),this.xtzPrice=s,a!=="USD"&&c?(this.defaultFiat="EUR",this.xtzExchangeRate=c):this.xtzExchangeRate=s.price}else throw"No response from the XTZ price API"}catch(n){console.error(n)}return this}async refresh(e){return await this.init(e)}updateInternalFiat(e,i){return this.defaultFiat=e,this.xtzExchangeRate=i,this}get(e){if(this.tokensList.includes(e)){const i=this.tokensPrices.find(l=>l.symbol===e);return i||null}else return null}getBySymbol(e){return this.get(e)}getByType(e){return this.tokensPrices.filter(i=>i.type===e)}getByAddress(e){const i=this.tokensPrices.find(l=>l.tokenAddress?l.tokenAddress.address===e:void 0);return i||null}getByTag(e,i){return i?this.tokensPrices.filter(l=>l.tags&&l.tags===e.toLowerCase()):this.tokensPrices.filter(l=>l.tags&&l.tags.toLowerCase().includes(e.toLowerCase()))}getTokensList(){return this.tokensList.sort((e,i)=>e>i?1:-1)}getTokensWithPriceGreaterThan(e){return this.tokensPrices.filter(i=>i.currentPrice?i.currentPrice>e:!1).sort((i,l)=>i.currentPrice&&l.currentPrice?i.currentPrice-l.currentPrice:0)}getTokensWithPriceLessThan(e){return this.tokensPrices.filter(i=>i.currentPrice?i.currentPrice<e:!1).sort((i,l)=>i.currentPrice&&l.currentPrice?i.currentPrice-l.currentPrice:0)}orderByUsdValue(e,i){const l=this.tokensPrices.sort((a,c)=>a.usdValue&&c.usdValue?e==="desc"?c.usdValue-a.usdValue:a.usdValue-c.usdValue:0);if(i){const a=i.filter(c=>!this.tokensList.includes(c));if(a.length>0)throw{message:"Unknown token(s)",list:a};return l.filter(c=>c.symbol?i.includes(c.symbol):!1)}else return l}orderByUsdValueDesc(e){return this.orderByUsdValue("desc",e)}orderByUsdValueAsc(e){return this.orderByUsdValue("asc",e)}getCurrentPrice(e){const i=this.tokensPrices.map(l=>({symbol:l.symbol,xtzPrice:l.currentPrice,fiatPrice:l.currentPrice&&this.xtzExchangeRate?l.currentPrice*this.xtzExchangeRate:null,fiat:this.defaultFiat}));if(e&&e.length>0){const l=e.filter(a=>!this.tokensList.includes(a));if(l.length>0)throw{message:"Unknown token(s)",list:l};return i.filter(a=>a.symbol?e.includes(a.symbol):!1)}else return i}}exports.TezToolsSDK=ee;exports.tokenType=Q;
